---
import { getCollection, getEntryBySlug } from 'astro:content';

// ✅ getStaticPaths() の定義
export async function getStaticPaths() {
  // "projects" コレクションのデータを取得
  const projects = await getCollection('projects');

  return projects.map((project) => ({
    params: { slug: project.slug }, // ✅ 各プロジェクトのスラグを指定
    props: { project: project.data }, // ✅ 各プロジェクトのデータを渡す
  }));
}

// ✅ URLのスラグを取得
const { slug } = Astro.params;

// ✅ スラグに対応するプロジェクトデータを取得
const project = await getEntryBySlug('projects', slug);

if (!project) {
  throw new Error(`🚨 Project "${slug}" not found`);
}

// ✅ 画像リストを作成
const images = [
  `/photo/${slug}/01.jpeg`,
  `/photo/${slug}/02.jpeg`,
  `/photo/${slug}/03.jpeg`
];
---

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{project?.data?.title || "プロジェクト詳細"}</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
      <h1>{project?.data?.title}</h1>
    </header>

    <main>
      <p class="project-caption">{project?.data?.caption || "キャプションがありません"}</p> 

      <div class="image-gallery">
        {images.map((image) => (
          <img src={image} alt={project?.data?.title} />
        ))}
      </div>

      <a href="/">← ホームへ戻る</a>
    </main>
</body>
</html>
